<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUVELE - Moda Feminina</title>
    <link rel="stylesheet" href="./assets/styles/base-fundamental.css">
    <link rel="shortcut icon" href="./assets/images/site-icon/fav.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./assets/styles/search-produto-card.css">
    <!-- CORREÇÃO: apontar para o arquivo correto de estilos da página de busca -->
    <link rel="stylesheet" href="./assets/styles/searchpage.css">
    <link rel="stylesheet" href="./assets/styles/footer(global).css">
    <link rel="stylesheet" href="./assets/styles/categorias0x1.css">

    <!-- mover Font Awesome para o head -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        crossorigin="anonymous">
</head>

<body>

    <!--PARTE DE CIMA Titulo, logotipo e Navbar-->
    <header class="search-header">
        <h1 class="search-title">Resultados da busca</h1>

        <p class="search-description">Encontre os produtos perfeitos para você! Filtre por categoria ou navegue pelas
            sugestões abaixo.</p>
        <div class="categorias-wrapper" aria-label="Categorias de produtos">
            <div id="categoriasList" class="categorias" role="list" tabindex="0"
                aria-label="Categorias (deslize para ver mais)">
                <div class="search-icon" aria-hidden="true">
                    <!-- NAV removido: será injetado por ../nav(globalcode).js -->
    </header>

    <!-- mantenha seu ícone atual aqui (ex.: <i class="fa fa-search"></i>) -->
    </div>

    <!-- Início: filtro de preço (abaixo das categorias) -->
    <div class="price-filter-wrapper" aria-hidden="false">
        <label for="priceFilter" class="price-filter-label">Filtrar por preço</label>
        <div class="price-filter" role="group" aria-label="Filtro de preço">
            <select id="priceFilter" class="price-select" aria-label="Selecionar faixa de preço">
                <option value="all">Todos os preços</option>
                <option value="0-50">Até R$50</option>
                <option value="50-100">R$50 - R$100</option>
                <option value="100-200">R$100 - R$200</option>
                <option value="200+">Acima de R$200</option>
                <option value="price-asc">Menor para maior</option>
                <option value="price-desc">Maior para menor</option>
            </select>
            <i class="fa-solid fa-chevron-down price-icon" aria-hidden="true"></i>
        </div>
    </div>
    <!-- Fim: filtro de preço -->

    <form id="siteSearch" class="search-bar" role="search" aria-label="Pesquisar no site" onsubmit="return false;">
        <input id="searchInput" type="search" placeholder="Pesquisar..." aria-label="Pesquisar" />
        <button id="searchSubmit" type="button" aria-label="Buscar">Buscar</button>
        <div id="searchResults" class="search-results" role="listbox" aria-hidden="true"></div>
    </form>

    <div class="container">
        <div id="produtosContainer" class="produtos-container" role="list"></div>
        <div id="produtosErro" class="produtos-erro" role="status" aria-live="polite" hidden>
            Não foi possível carregar os produtos no momento.
        </div>

        <!-- PAGINAÇÃO -->
        <div id="pagination" class="pagination" aria-label="Paginação de produtos">
            <button id="prevPage" class="pagination-btn" disabled>&lt; Anterior</button>
            <span id="paginationInfo" class="pagination-info">1 de 1</span>
            <button id="nextPage" class="pagination-btn" disabled>Próximo &gt;</button>
        </div>
    </div>


    <!-- Container para os cartões de produto (será preenchido pelo script abaixo) -->
    <main id="searchResultsContainer" class="products-grid" aria-live="polite"></main>

    <!-- pr-def deve ser carregado antes de nav.js -->
    <script src="./assets/javascript/pr-def.js"></script>
    <!-- injeta o markup da nav (com ajustes de href e estilos injetados) -->
    <script src="./assets/javascript/nav(globalcode).js"></script>
    <!-- lógica do menu/search que depende de pr-def.js -->
    <script src="./assets/javascript/nav.js"></script>
    <script src="./assets/javascript/sys-ger-prod.js"></script>
    <script src="./assets/javascript/search-results.js"></script>
    <script src="./assets/javascript/footer(global).js"></script>


    <style>
        /* Adicionado: estilos simples e elegantes para o filtro de preço */
        .price-filter-wrapper {
            /* centraliza o filtro e evita que encoste na esquerda em telas largas */
            margin: 12px auto;
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: inherit;
            max-width: 1100px;
            /* limita largura para alinhar com o conteúdo principal */
            padding: 0 20px;
            /* distância lateral das bordas */
            box-sizing: border-box;
        }

        .price-filter-label {
            font-size: 0.95rem;
            color: #444;
        }

        .price-filter {
            position: relative;
            display: inline-block;
        }

        .price-select {
            -webkit-appearance: none;
            appearance: none;
            padding: 8px 36px 8px 12px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            background: #fff;
            font-size: 0.95rem;
            color: #222;
            cursor: pointer;
            min-width: 160px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.02);
        }

        .price-select:focus {
            outline: 2px solid rgba(0, 123, 255, 0.15);
            border-color: #a6c8ff;
        }

        .price-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            pointer-events: none;
            font-size: 0.9rem;
        }

        .price-filter-disabled {
            opacity: 0.5;
            pointer-events: none;
            user-select: none;
        }

        /* pequenos ajustes responsivos */
        @media (max-width: 520px) {
            .price-filter-wrapper {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
                padding: 0 12px;
            }

            .price-select {
                min-width: 100%;
            }
        }

        /* em telas muito largas, garantir que o filtro permaneça alinhado ao centro do conteúdo */
        @media (min-width: 1200px) {
            .price-filter-wrapper {
                max-width: 1200px;
                padding: 0 32px;
            }
        }

        /* Substituído: .filter-no-results-msg continua absoluta, mas usamos um spacer para reservar espaço */
        .filter-no-results-msg {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            background: #fff6f6;
            border: 1px solid #ffd6d6;
            border-radius: 8px;
            font-size: 1.15rem;
            color: #b23c3c;
            font-family: Montserrat, sans-serif;
            font-weight: 400;
            box-shadow: 0 2px 8px 0 rgba(200, 0, 0, 0.04);

            /* Mantém posição absoluta (solicitado) */
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 16px;
            /* distância do topo do container */
            width: calc(100% - 40px);
            max-width: 1100px;
            box-sizing: border-box;
            z-index: 20;
        }

        /* Spacer que reserva espaço no fluxo quando a mensagem está visível */
        .filter-no-results-spacer {
            display: none;
            /* será ativado via JS quando necessário */
            width: 100%;
            height: 0;
            box-sizing: border-box;
            pointer-events: none;
            visibility: hidden;
            /* não deve ser perceptível, apenas reserva espaço */
        }

        /* Garante que os containers sirvam de referência para o absolute */
        .produtos-container,
        .products-grid {
            position: relative;
        }
    </style>

    <!-- Script para filtrar por categoria (exemplo básico) -->
    <script>
        // Adicionado: lógica de filtragem por preço e ordenação
        (function () {
            const select = document.getElementById('priceFilter');
            const wrapper = document.querySelector('.price-filter-wrapper');
            if (!select) return;

            // Função para contar produtos "brutos" (antes de filtro de preço)
            function getRawProductItems() {
                const containers = [
                    document.getElementById('produtosContainer'),
                    document.getElementById('searchResultsContainer')
                ].filter(Boolean);
                let items = [];
                containers.forEach(container => {
                    items = items.concat(Array.from(container.querySelectorAll('[data-price], .produto-card, .product-card, .produto, [role="listitem"]')));
                });
                return items;
            }

            // Torna filtro inacessível se só houver 1 produto bruto (antes de filtro de preço)
            function updatePriceFilterAccessibility() {
                const items = getRawProductItems();
                // conta apenas produtos realmente presentes (não display:none)
                const visibleItems = items.filter(it => it.offsetParent !== null);
                // NOVO: se não houver nenhum produto visível, desabilita o filtro
                if (visibleItems.length === 0) {
                    select.disabled = true;
                    wrapper.classList.add('price-filter-disabled');
                } else if (visibleItems.length === 1) {
                    select.disabled = true;
                    wrapper.classList.add('price-filter-disabled');
                } else {
                    select.disabled = false;
                    wrapper.classList.remove('price-filter-disabled');
                }
            }

            select.addEventListener('change', applyPriceFilter);

            // aplica filtro/ordenação ao mudar e no carregamento
            applyPriceFilter();
            updatePriceFilterAccessibility();

            function applyPriceFilter() {
                const value = select.value;
                const containers = [
                    document.getElementById('produtosContainer'),
                    document.getElementById('searchResultsContainer')
                ].filter(Boolean);

                // Remove todas as mensagens de filtro antes de processar
                containers.forEach(container => {
                    container.querySelectorAll('#filterNoResultsMsg').forEach(el => el.remove());
                    const spacer = container.querySelector('.filter-no-results-spacer');
                    if (spacer) {
                        spacer.style.display = 'none';
                        spacer.style.height = '0';
                    }
                });

                // Aplica filtro e ordenação normalmente
                containers.forEach(container => {
                    // coletar itens (preservando apenas os elementos de produto)
                    const items = Array.from(container.querySelectorAll('[data-price], .produto-card, .product-card, .produto, [role="listitem"]'));

                    // aplicar filtro de faixa (se aplicável)
                    items.forEach(item => {
                        let price = getPrice(item);
                        let visible = true;
                        if (value === '0-50') visible = (price != null) ? price <= 50 : true;
                        else if (value === '50-100') visible = (price != null) ? price > 50 && price <= 100 : true;
                        else if (value === '100-200') visible = (price != null) ? price > 100 && price <= 200 : true;
                        else if (value === '200+') visible = (price != null) ? price > 200 : true;
                        else if (value === 'all' || value === 'price-asc' || value === 'price-desc') visible = true;
                        item.style.display = visible ? '' : 'none';
                    });

                    // se o valor indica ordenação, ordenar os itens visíveis
                    if (value === 'price-asc' || value === 'price-desc') {
                        const visibleItems = items.filter(it => it.style.display !== 'none');
                        visibleItems.sort((a, b) => {
                            const pa = getPrice(a), pb = getPrice(b);
                            // itens sem preço vão para o final
                            if (pa == null && pb == null) return 0;
                            if (pa == null) return 1;
                            if (pb == null) return -1;
                            return value === 'price-asc' ? pa - pb : pb - pa;
                        });
                        // reapendar na nova ordem
                        visibleItems.forEach(it => container.appendChild(it));
                    }
                });

                // Após aplicar o filtro, verifica se há pelo menos UM produto visível em TODOS os containers
                let anyVisible = false;
                containers.forEach(container => {
                    const items = Array.from(container.querySelectorAll('[data-price], .produto-card, .product-card, .produto, [role="listitem"]'));
                    if (items.some(it => it.style.display !== 'none')) {
                        anyVisible = true;
                    }
                });

                if (!anyVisible) {
                    // Exibe a mensagem apenas no primeiro container
                    const container = containers[0];
                    const items = Array.from(container.querySelectorAll('[data-price], .produto-card, .product-card, .produto, [role="listitem"]'));
                    // Esconde todos os produtos
                    items.forEach(it => it.style.display = 'none');
                    // cria/garante spacer que reserva espaço no fluxo
                    let spacer = container.querySelector('.filter-no-results-spacer');
                    if (!spacer) {
                        spacer = document.createElement('div');
                        spacer.className = 'filter-no-results-spacer';
                        container.appendChild(spacer);
                    }
                    // cria a mensagem absoluta
                    const filterMsgEl = document.createElement('div');
                    filterMsgEl.id = 'filterNoResultsMsg';
                    filterMsgEl.className = 'filter-no-results-msg';
                    filterMsgEl.textContent = 'Nenhum resultado encontrado para esse filtro.';
                    container.appendChild(filterMsgEl);
                    filterMsgEl.hidden = false;
                    if (!container.style.position) container.style.position = container.style.position;
                    requestAnimationFrame(() => {
                        const h = filterMsgEl.getBoundingClientRect().height;
                        spacer.style.height = h + 'px';
                        spacer.style.display = 'block';
                        spacer.style.visibility = 'hidden';
                    });
                }
                // Se houver algum produto visível, a mensagem já foi removida acima
            }

            function getPrice(item) {
                // primeiro tenta data-price (numérico)
                if (item.dataset && item.dataset.price) {
                    const v = parseFloat(item.dataset.price);
                    if (Number.isFinite(v)) return v;
                }
                // depois tenta elementos de preço conhecidos (inclui .produto-preco-atual)
                const priceEl = item.querySelector('.produto-preco-atual, .price, .product-price, .preco, .valor');
                if (priceEl) {
                    // extrai apenas números e separadores e normaliza vírgula para ponto
                    const txt = priceEl.textContent.replace(/[^\d,\.]/g, '').replace(',', '.');
                    const parsed = parseFloat(txt);
                    if (Number.isFinite(parsed)) return parsed;
                }
                return null;
            }

            // Monitora mudanças de pesquisa para atualizar acessibilidade do filtro
            // (hook simples para search-results.js ou outros scripts que atualizem os produtos)
            const observer = new MutationObserver(() => {
                updatePriceFilterAccessibility();
            });
            const mainContainers = [
                document.getElementById('produtosContainer'),
                document.getElementById('searchResultsContainer')
            ].filter(Boolean);
            mainContainers.forEach(mainContainer => {
                observer.observe(mainContainer, { childList: true, subtree: true });
            });
        })();
    </script>
    <script src="./assets/javascript/categorias0x1.js"></script>
    <script src="./assets/javascript/searchpage.js"></script>
</body>

</html>